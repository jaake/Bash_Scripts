#!/bin/bash
#Point this at your initramfs to see what's inside 
#EXAMPLE  # edit_initramfs /path/to/file
#It plops it into whichever directory you are currently in.

dir_name="extracted_initramfs"

# Check for type of archive
type=$( file -b "$1" ) 

fail() {
exit 1
}

# Check for root permissions
if [ "$(id -u)" != "0" ]; then
    echo "You must have root permissions to run this script" 
    exit 1
fi

echo Creating working directory ...
mkdir $dir_name || fail 
cd $dir_name 

unzip_xz() {
cp $1 zipped.cpio.xz || fail
echo Unzipping and decrompressing ...
unxz zipped.cpio.xz  || exit 
}

unzip_bzip() {
cp $1 zipped.cpio.bz2 || fail
echo Unzipping and decrompressing ...
bunzip zipped.cpio.bz2  || exit 
}

unzip_gzip() {
cp $1 zipped.cpio.gz || fail
echo Unzipping and decrompressing ...
gunzip zipped.cpio.gz  || exit 
}


case "$type" in
	
  *XZ*) unzip_xz $1
	;;
	
  *bzip2*) unzip_bzip $1
	;;
	
  *gzip*) unzip_gzip $1
	;;
	
  *) echo "not a recognized compressed filetype" && exit 1
	;;

esac	


cpio -id < zipped.cpio 
rm zipped.cpio 

echo Success! 
echo
echo The directory "$dir_name" should now contain the contents of the initramfs

